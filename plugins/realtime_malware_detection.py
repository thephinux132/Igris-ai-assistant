"""
Simulated Real-time Malware Detection Plugin
- Monitors running processes for suspicious activity (simulated).
- Generates alerts if anomalies are detected.
"""
import psutil
import time

def run():
    anomalous_processes = []
    try:
        for process in psutil.process_iter(['name', 'cpu_percent', 'memory_percent']):
            if process.info['cpu_percent'] > 80 or process.info['memory_percent'] > 50:
                anomalous_processes.append(f"{process.info['name']} (CPU: {process.info['cpu_percent']}%, Mem: {process.info['memory_percent']}%")
    except Exception as e:
        return f"[ERROR] Could not scan processes: {e}"

    if anomalous_processes:
        report = "Potential malware/anomalous activity detected:\n" + "\n".join(anomalous_processes)
        return report
    else:
        return "No anomalous processes detected."

if __name__ == "__main__":
    # test
    print(run())